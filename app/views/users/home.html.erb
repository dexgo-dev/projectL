<p id="notice"><%= notice %></p>
<p>
<%= form_tag(user_home_path(@current_user.id), method: "get") do %>
  Find Participant by Name: <%= text_field_tag(:search) %>
  <br/><br/>Show:&nbsp;
  <% if params[:filter_participants_by_study].nil? %>
    <%= select(:filter_participants_by_study, :filter_participants_by_study_val, options_from_collection_for_select(@active_studies, 'id', 'study_name'), include_blank: 'All Studies') %>
  <% else %>
    <%= select(:filter_participants_by_study, :filter_participants_by_study_val, options_from_collection_for_select(@active_studies, 'id', 'study_name', :selected => params[:filter_participants_by_study][:filter_participants_by_study_val]), include_blank: 'All Studies') %>
  <% end %>
  <br/><br/><%= submit_tag("Find") %>&nbsp;
  <%= link_to 'Reset', user_home_path(@current_user) %>
<% end %>
</p>


<h2><%=@search_or_recent_header %></h2>
<% unless @search_participants.empty? %>
<table>
   <thead>
       <tr>
         <th>Last Contact Date</th>
         <th>Participant</th>
         <th>Contact Number</th>
         <th>Email Address</th>
         <th>Study</th>
         <th>Status</th>
         <% if @current_user.isAdmin? %>
          <th colspan="3"></th>
         <% else %>
          <th colspan="2"></th>
         <% end %>
       </tr>
  </thead> 
   <tbody>
      <% @search_participants.each do |participant| %>
       <tr>
         <td><% unless participant.last_contacted_at.nil? %> <%=time_ago_in_words(participant.last_contacted_at)%> ago <% end %></td>
         <td><%= link_to participant.name, participant %></td>
         <td><%= participant.contact_number %></td>
         <td><%= link_to participant.email %></td>
         <td><%= participant.study.study_name %></td>
         <td><%= ((participant.active)? ('Active'):('Dropped Out')) %></td>
         <td><%= link_to 'Show', participant %></td>
         <td><%= link_to 'Edit', edit_participant_path(participant) %></td>
         <% if @current_user.isAdmin? %>
          <td><%= link_to 'Destroy', participant, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        <% end %>
       </tr>
      <% end %>
   </tbody>
</table>
<%=will_paginate(@search_participants, :param_name => 'search_participants_page') %>
<% end %>

<h2><%=@upcoming_notes_notification_header %></h2>
<% unless @upcoming_notes_notification.empty? %>
 <table>
  <thead>
     <tr>
      <th>&nbsp;</th>
      <th>Participant</th>
      <th colspan="2">Notification Date</th>
     </tr>
  </thead> 
  <tbody>
    <% @upcoming_notes_notification.each do |note| %>
    <tr>
      <td><%= link_to "See Note.", participant_note_path(note.participant.id,note.id)%></td>
      <td><%= link_to note.participant.name, note.participant %>
      <td><%= link_to "Snooze", edit_participant_note_path(note.participant.id,note.id) %></td>
      <td><%=note.notify_on.inspect%></td>
    </tr>
    <% end %>
  </tbody>
</table>
<% end %>
<%=will_paginate(@upcoming_notes_notification, :param_name => 'upcoming_notes_notification_page') %>

 <h2><%=@recent_notes_from_user_header%></h2>
 <% unless @recent_notes_from_user.empty? %>
 <table>
    <thead>
       <tr>
        <th>&nbsp;</th>
        <th>Participant</th>
        <th>Last Modified</th>
       </tr>
    </thead> 
    <tbody>
      <% @recent_notes_from_user.each do |note| %>
      <tr>
        <td><%= link_to "See Note.", participant_note_path(note.participant.id,note.id)%></td>
        <td><%= link_to note.participant.name, note.participant %>
        <td><%= time_ago_in_words(note.updated_at)%> ago</td>
      </tr>
      <% end %>
    </tbody>
 </table>
<%=will_paginate(@recent_notes_from_user, :param_name => 'recent_notes_from_user_page') %>
<% end %>